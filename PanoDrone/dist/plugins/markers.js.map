{"version":3,"file":"markers.js","sources":["../../src/plugins/markers/utils.js","../../src/plugins/markers/Marker.js","../../src/plugins/markers/MarkersButton.js","../../src/plugins/markers/MarkersListButton.js","../../src/plugins/markers/index.js"],"sourcesContent":["import { CONSTANTS, utils } from 'photo-sphere-viewer';\n\n/**\n * Returns intermediary point between two points on the sphere\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @param {number[]} p1\n * @param {number[]} p2\n * @param {number} f\n * @returns {number[]}\n * @private\n */\nexport function greatArcIntermediaryPoint(p1, p2, f) {\n  const [λ1, φ1] = p1;\n  const [λ2, φ2] = p2;\n\n  const r = utils.greatArcDistance(p1, p2);\n  const a = Math.sin((1 - f) * r) / Math.sin(r);\n  const b = Math.sin(f * r) / Math.sin(r);\n  const x = a * Math.cos(φ1) * Math.cos(λ1) + b * Math.cos(φ2) * Math.cos(λ2);\n  const y = a * Math.cos(φ1) * Math.sin(λ1) + b * Math.cos(φ2) * Math.sin(λ2);\n  const z = a * Math.sin(φ1) + b * Math.sin(φ2);\n\n  return [\n    Math.atan2(y, x),\n    Math.atan2(z, Math.sqrt(x * x + y * y)),\n  ];\n}\n\n/**\n * @summary Computes the center point of a polygon\n * @todo Get \"visual center\" (https://blog.mapbox.com/a-new-algorithm-for-finding-a-visual-center-of-a-polygon-7c77e6492fbc)\n * @param {number[][]} polygon\n * @returns {number[]}\n * @private\n */\nexport function getPolygonCenter(polygon) {\n  // apply offsets to avoid crossing the origin\n  const workPoints = [polygon[0]];\n\n  let k = 0;\n  for (let i = 1; i < polygon.length; i++) {\n    const d = polygon[i - 1][0] - polygon[i][0];\n    if (d > Math.PI) { // crossed the origin left to right\n      k += 1;\n    }\n    else if (d < -Math.PI) { // crossed the origin right to left\n      k -= 1;\n    }\n    workPoints.push([polygon[i][0] + k * 2 * Math.PI, polygon[i][1]]);\n  }\n\n  const sum = workPoints.reduce((intermediary, point) => [intermediary[0] + point[0], intermediary[1] + point[1]]);\n  return [utils.parseAngle(sum[0] / polygon.length), sum[1] / polygon.length];\n}\n\n/**\n * @summary Computes the middle point of a polyline\n * @param {number[][]} polyline\n * @returns {number[]}\n * @private\n */\nexport function getPolylineCenter(polyline) {\n  // compute each segment length + total length\n  let length = 0;\n  const lengths = [];\n\n  for (let i = 0; i < polyline.length - 1; i++) {\n    const l = utils.greatArcDistance(polyline[i], polyline[i + 1]) * CONSTANTS.SPHERE_RADIUS;\n\n    lengths.push(l);\n    length += l;\n  }\n\n  // iterate until length / 2\n  let consumed = 0;\n\n  for (let j = 0; j < polyline.length - 1; j++) {\n    // once the segment containing the middle point is found, computes the intermediary point\n    if (consumed + lengths[j] > length / 2) {\n      const r = (length / 2 - consumed) / lengths[j];\n      return greatArcIntermediaryPoint(polyline[j], polyline[j + 1], r);\n    }\n\n    consumed += lengths[j];\n  }\n\n  // this never happens\n  return polyline[Math.round(polyline.length / 2)];\n}\n","import { CONSTANTS, PSVError, utils } from 'photo-sphere-viewer';\nimport MarkersPlugin from './index';\nimport { getPolygonCenter, getPolylineCenter } from './utils';\n\n/**\n * @summary Types of marker\n * @memberOf PSV.plugins.MarkersPlugin\n * @enum {string}\n * @constant\n * @private\n */\nconst MARKER_TYPES = {\n  image      : 'image',\n  html       : 'html',\n  polygonPx  : 'polygonPx',\n  polygonRad : 'polygonRad',\n  polylinePx : 'polylinePx',\n  polylineRad: 'polylineRad',\n  square     : 'square',\n  rect       : 'rect',\n  circle     : 'circle',\n  ellipse    : 'ellipse',\n  path       : 'path',\n};\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Properties\n * @summary Marker properties, see {@link http://photo-sphere-viewer.js.org/plugins/plugin-markers.html#markers-options}\n */\n\n/**\n * @summary Object representing a marker\n * @memberOf PSV.plugins.MarkersPlugin\n */\nexport class Marker {\n\n  /**\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {PSV.Viewer} psv\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  constructor(properties, psv) {\n    if (!properties.id) {\n      throw new PSVError('missing marker id');\n    }\n\n    /**\n     * @member {PSV.Viewer}\n     * @readonly\n     * @protected\n     */\n    this.psv = psv;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.id = properties.id;\n\n    /**\n     * @member {string}\n     * @readonly\n     */\n    this.type = Marker.getType(properties, false);\n\n    /**\n     * @member {boolean}\n     * @protected\n     */\n    this.visible = true;\n\n    /**\n     * @member {HTMLElement|SVGElement}\n     * @readonly\n     */\n    this.$el = null;\n\n    /**\n     * @summary Original configuration of the marker\n     * @member {PSV.plugins.MarkersPlugin.Properties}\n     * @readonly\n     */\n    this.config = {};\n\n    /**\n     * @summary User data associated to the marker\n     * @member {any}\n     */\n    this.data = undefined;\n\n    /**\n     * @summary Tooltip instance for this marker\n     * @member {PSV.components.Tooltip}\n     */\n    this.tooltip = null;\n\n    /**\n     * @summary Computed properties\n     * @member {Object}\n     * @protected\n     * @property {boolean} inViewport\n     * @property {boolean} dynamicSize\n     * @property {PSV.Point} anchor\n     * @property {PSV.Position} position - position in spherical coordinates\n     * @property {PSV.Point} position2D - position in viewer coordinates\n     * @property {external:THREE.Vector3[]} positions3D - positions in 3D space\n     * @property {number} width\n     * @property {number} height\n     * @property {*} def\n     */\n    this.props = {\n      inViewport : false,\n      dynamicSize: false,\n      anchor     : null,\n      position   : null,\n      position2D : null,\n      positions3D: null,\n      width      : null,\n      height     : null,\n      def        : null,\n    };\n\n    // create element\n    if (this.isNormal()) {\n      this.$el = document.createElement('div');\n    }\n    else if (this.isPolygon()) {\n      this.$el = document.createElementNS(MarkersPlugin.SVG_NS, 'polygon');\n    }\n    else if (this.isPolyline()) {\n      this.$el = document.createElementNS(MarkersPlugin.SVG_NS, 'polyline');\n    }\n    else {\n      this.$el = document.createElementNS(MarkersPlugin.SVG_NS, this.type);\n    }\n\n    this.$el.id = `psv-marker-${this.id}`;\n    this.$el[MarkersPlugin.MARKER_DATA] = this;\n\n    this.update(properties);\n  }\n\n  /**\n   * @summary Destroys the marker\n   */\n  destroy() {\n    delete this.$el[MarkersPlugin.MARKER_DATA];\n    delete this.$el;\n    delete this.config;\n    delete this.props;\n    delete this.psv;\n  }\n\n  /**\n   * @summary Checks if it is a normal marker (image or html)\n   * @returns {boolean}\n   */\n  isNormal() {\n    return this.type === MARKER_TYPES.image\n      || this.type === MARKER_TYPES.html;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline marker\n   * @returns {boolean}\n   */\n  isPoly() {\n    return this.isPolygon()\n      || this.isPolyline();\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using pixel coordinates\n   * @returns {boolean}\n   */\n  isPolyPx() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polylinePx;\n  }\n\n  /**\n   * @summary Checks if it is a polygon/polyline using radian coordinates\n   * @returns {boolean}\n   */\n  isPolyRad() {\n    return this.type === MARKER_TYPES.polygonRad\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is a polygon marker\n   * @returns {boolean}\n   */\n  isPolygon() {\n    return this.type === MARKER_TYPES.polygonPx\n      || this.type === MARKER_TYPES.polygonRad;\n  }\n\n  /**\n   * @summary Checks if it is a polyline marker\n   * @returns {boolean}\n   */\n  isPolyline() {\n    return this.type === MARKER_TYPES.polylinePx\n      || this.type === MARKER_TYPES.polylineRad;\n  }\n\n  /**\n   * @summary Checks if it is an SVG marker\n   * @returns {boolean}\n   */\n  isSvg() {\n    return this.type === MARKER_TYPES.square\n      || this.type === MARKER_TYPES.rect\n      || this.type === MARKER_TYPES.circle\n      || this.type === MARKER_TYPES.ellipse\n      || this.type === MARKER_TYPES.path;\n  }\n\n  /**\n   * @summary Computes marker scale from zoom level\n   * @param {number} zoomLevel\n   * @returns {number}\n   */\n  getScale(zoomLevel) {\n    if (Array.isArray(this.config.scale)) {\n      return this.config.scale[0] + (this.config.scale[1] - this.config.scale[0]) * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n    }\n    else if (typeof this.config.scale === 'function') {\n      return this.config.scale(zoomLevel);\n    }\n    else if (typeof this.config.scale === 'number') {\n      return this.config.scale * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n    }\n    else {\n      return 1;\n    }\n  }\n\n  /**\n   * @summary Returns the markers list content for the marker, it can be either :\n   * - the `listContent`\n   * - the `tooltip.content`\n   * - the `html`\n   * - the `id`\n   * @returns {*}\n   */\n  getListContent() {\n    if (this.config.listContent) {\n      return this.config.listContent;\n    }\n    else if (this.config.tooltip) {\n      return this.config.tooltip.content;\n    }\n    else if (this.config.html) {\n      return this.config.html;\n    }\n    else {\n      return this.id;\n    }\n  }\n\n  /**\n   * @summary Display the tooltip of this marker\n   * @param {{clientX: number, clientY: number}} [mousePosition]\n   */\n  showTooltip(mousePosition) {\n    if (this.visible && this.config.tooltip && this.props.position2D) {\n      const config = {\n        content : this.config.tooltip.content,\n        position: this.config.tooltip.position,\n        data    : this,\n      };\n\n      if (this.isPoly()) {\n        const boundingRect = this.psv.container.getBoundingClientRect();\n\n        config.box = { // separate the tooltip from the cursor\n          width : this.psv.tooltip.size.arrow * 2,\n          height: this.psv.tooltip.size.arrow * 2,\n        };\n\n        if (mousePosition) {\n          config.top = mousePosition.clientY - boundingRect.top - this.psv.tooltip.size.arrow / 2;\n          config.left = mousePosition.clientX - boundingRect.left - this.psv.tooltip.size.arrow;\n        }\n        else {\n          config.top = this.props.position2D.y;\n          config.left = this.props.position2D.x;\n        }\n      }\n      else {\n        config.top = this.props.position2D.y;\n        config.left = this.props.position2D.x;\n        config.box = {\n          width : this.props.width,\n          height: this.props.height,\n        };\n      }\n\n      if (this.tooltip) {\n        this.tooltip.move(config);\n      }\n      else {\n        this.tooltip = this.psv.tooltip.create(config);\n      }\n    }\n  }\n\n  /**\n   * @summary Hides the tooltip of this marker\n   */\n  hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.hide();\n      this.tooltip = null;\n    }\n  }\n\n  /**\n   * @summary Updates the marker with new properties\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @throws {PSV.PSVError} when the configuration is incorrect\n   */\n  update(properties) {\n    const newType = Marker.getType(properties, true);\n\n    if (newType !== undefined && newType !== this.type) {\n      throw new PSVError('cannot change marker type');\n    }\n\n    utils.deepmerge(this.config, properties);\n    this.data = this.config.data;\n\n    this.visible = properties.visible !== false;\n\n    // reset CSS class\n    if (this.isNormal()) {\n      this.$el.setAttribute('class', 'psv-marker psv-marker--normal');\n    }\n    else {\n      this.$el.setAttribute('class', 'psv-marker psv-marker--svg');\n    }\n\n    // add CSS classes\n    if (this.config.className) {\n      utils.addClasses(this.$el, this.config.className);\n    }\n    if (this.config.tooltip) {\n      utils.addClasses(this.$el, 'psv-marker--has-tooltip');\n      if (typeof this.config.tooltip === 'string') {\n        this.config.tooltip = { content: this.config.tooltip };\n      }\n    }\n    if (this.config.content) {\n      utils.addClasses(this.$el, 'psv-marler--has-content');\n    }\n\n    // apply style\n    if (this.config.style) {\n      utils.deepmerge(this.$el.style, this.config.style);\n    }\n\n    // parse anchor\n    this.props.anchor = utils.parsePosition(this.config.anchor);\n\n    if (this.isNormal()) {\n      this.__updateNormal();\n    }\n    else if (this.isPoly()) {\n      this.__updatePoly();\n    }\n    else {\n      this.__updateSvg();\n    }\n  }\n\n  /**\n   * @summary Updates a normal marker\n   * @private\n   */\n  __updateNormal() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    if (this.config.image && (!this.config.width || !this.config.height)) {\n      throw new PSVError('missing marker width/height');\n    }\n\n    if (this.config.width && this.config.height) {\n      this.props.dynamicSize = false;\n      this.props.width = this.config.width;\n      this.props.height = this.config.height;\n      this.$el.style.width = this.config.width + 'px';\n      this.$el.style.height = this.config.height + 'px';\n    }\n    else {\n      this.props.dynamicSize = true;\n    }\n\n    if (this.config.image) {\n      this.props.def = this.config.image;\n      this.$el.style.backgroundImage = `url(${this.config.image})`;\n    }\n    else if (this.config.html) {\n      this.props.def = this.config.html;\n      this.$el.innerHTML = this.config.html;\n    }\n\n    // set anchor\n    this.$el.style.transformOrigin = `${this.props.anchor.x * 100}% ${this.props.anchor.y * 100}%`;\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates an SVG marker\n   * @private\n   */\n  __updateSvg() {\n    if (!utils.isExtendedPosition(this.config)) {\n      throw new PSVError('missing marker position, latitude/longitude or x/y');\n    }\n\n    this.props.dynamicSize = true;\n\n    // set content\n    switch (this.type) {\n      case MARKER_TYPES.square:\n        this.props.def = {\n          x     : 0,\n          y     : 0,\n          width : this.config.square,\n          height: this.config.square,\n        };\n        break;\n\n      case MARKER_TYPES.rect:\n        if (Array.isArray(this.config.rect)) {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect[0],\n            height: this.config.rect[1],\n          };\n        }\n        else {\n          this.props.def = {\n            x     : 0,\n            y     : 0,\n            width : this.config.rect.width,\n            height: this.config.rect.height,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.circle:\n        this.props.def = {\n          cx: this.config.circle,\n          cy: this.config.circle,\n          r : this.config.circle,\n        };\n        break;\n\n      case MARKER_TYPES.ellipse:\n        if (Array.isArray(this.config.ellipse)) {\n          this.props.def = {\n            cx: this.config.ellipse[0],\n            cy: this.config.ellipse[1],\n            rx: this.config.ellipse[0],\n            ry: this.config.ellipse[1],\n          };\n        }\n        else {\n          this.props.def = {\n            cx: this.config.ellipse.rx,\n            cy: this.config.ellipse.ry,\n            rx: this.config.ellipse.rx,\n            ry: this.config.ellipse.ry,\n          };\n        }\n        break;\n\n      case MARKER_TYPES.path:\n        this.props.def = {\n          d: this.config.path,\n        };\n        break;\n\n      // no default\n    }\n\n    utils.each(this.props.def, (value, prop) => {\n      this.$el.setAttributeNS(null, prop, value);\n    });\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n    }\n    else {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n\n    // convert texture coordinates to spherical coordinates\n    this.props.position = this.psv.dataHelper.cleanPosition(this.config);\n\n    // compute x/y/z position\n    this.props.positions3D = [this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)];\n  }\n\n  /**\n   * @summary Updates a polygon marker\n   * @private\n   */\n  __updatePoly() {\n    this.props.dynamicSize = true;\n\n    // set style\n    if (this.config.svgStyle) {\n      utils.each(this.config.svgStyle, (value, prop) => {\n        this.$el.setAttributeNS(null, utils.dasherize(prop), value);\n      });\n\n      if (this.isPolyline() && !this.config.svgStyle.fill) {\n        this.$el.setAttributeNS(null, 'fill', 'none');\n      }\n    }\n    else if (this.isPolygon()) {\n      this.$el.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n    }\n    else if (this.isPolyline()) {\n      this.$el.setAttributeNS(null, 'fill', 'none');\n      this.$el.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');\n    }\n\n    // fold arrays: [1,2,3,4] => [[1,2],[3,4]]\n    const actualPoly = this.config.polygonPx || this.config.polygonRad || this.config.polylinePx || this.config.polylineRad;\n    if (!Array.isArray(actualPoly[0])) {\n      for (let i = 0; i < actualPoly.length; i++) {\n        actualPoly.splice(i, 2, [actualPoly[i], actualPoly[i + 1]]);\n      }\n    }\n\n    // convert texture coordinates to spherical coordinates\n    if (this.isPolyPx()) {\n      this.props.def = actualPoly.map((coord) => {\n        const sphericalCoords = this.psv.dataHelper.textureCoordsToSphericalCoords({ x: coord[0], y: coord[1] });\n        return [sphericalCoords.longitude, sphericalCoords.latitude];\n      });\n    }\n    // clean angles\n    else {\n      this.props.def = actualPoly.map((coord) => {\n        return [utils.parseAngle(coord[0]), utils.parseAngle(coord[1], true)];\n      });\n    }\n\n    const centroid = this.isPolygon()\n      ? getPolygonCenter(this.props.def)\n      : getPolylineCenter(this.props.def);\n\n    this.props.position = {\n      longitude: centroid[0],\n      latitude : centroid[1],\n    };\n\n    // compute x/y/z positions\n    this.props.positions3D = this.props.def.map((coord) => {\n      return this.psv.dataHelper.sphericalCoordsToVector3({ longitude: coord[0], latitude: coord[1] });\n    });\n  }\n\n  /**\n   * @summary Determines the type of a marker by the available properties\n   * @param {Marker.Properties} properties\n   * @param {boolean} [allowNone=false]\n   * @returns {string}\n   * @throws {PSV.PSVError} when the marker's type cannot be found\n   */\n  static getType(properties, allowNone = false) {\n    const found = [];\n\n    utils.each(MARKER_TYPES, (type) => {\n      if (type in properties) {\n        found.push(type);\n      }\n    });\n\n    if (found.length === 0 && !allowNone) {\n      throw new PSVError(`missing marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n    else if (found.length > 1) {\n      throw new PSVError(`multiple marker content, either ${Object.keys(MARKER_TYPES).join(', ')}`);\n    }\n\n    return found[0];\n  }\n\n}\n","import { AbstractButton } from 'photo-sphere-viewer';\nimport MarkersPlugin from './index';\nimport pin from './pin.svg';\n\n/**\n * @summary Navigation bar markers button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersButton extends AbstractButton {\n\n  static id = 'markers';\n  static icon = pin;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin(MarkersPlugin.id);\n\n    if (this.plugin) {\n      this.plugin.on(MarkersPlugin.EVENTS.SHOW_MARKERS, this);\n      this.plugin.on(MarkersPlugin.EVENTS.HIDE_MARKERS, this);\n\n      this.toggleActive(true);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(MarkersPlugin.EVENTS.SHOW_MARKERS, this);\n      this.plugin.off(MarkersPlugin.EVENTS.HIDE_MARKERS, this);\n    }\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case MarkersPlugin.EVENTS.SHOW_MARKERS: this.toggleActive(true); break;\n      case MarkersPlugin.EVENTS.HIDE_MARKERS: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers\n   */\n  onClick() {\n    if (this.plugin.prop.visible) {\n      this.plugin.hide();\n    }\n    else {\n      this.plugin.show();\n    }\n  }\n\n}\n","import { AbstractButton, CONSTANTS } from 'photo-sphere-viewer';\nimport MarkersPlugin from './index';\nimport pinList from './pin-list.svg';\n\n/**\n * @summary Navigation bar markers list button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class MarkersListButton extends AbstractButton {\n\n  static id = 'markersList';\n  static icon = pinList;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-markers-list-button', true);\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin}\n     */\n    this.plugin = this.psv.getPlugin(MarkersPlugin.id);\n\n    if (this.plugin) {\n      this.psv.on(CONSTANTS.EVENTS.OPEN_PANEL, this);\n      this.psv.on(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n    }\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.OPEN_PANEL, this);\n    this.psv.off(CONSTANTS.EVENTS.CLOSE_PANEL, this);\n\n    super.destroy();\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case CONSTANTS.EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === MarkersPlugin.ID_PANEL_MARKERS_LIST); break;\n      case CONSTANTS.EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @description Toggles markers list\n   */\n  onClick() {\n    this.plugin.toggleMarkersList();\n  }\n\n}\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from 'photo-sphere-viewer';\nimport * as THREE from 'three';\nimport { Marker } from './Marker';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\nimport icon from './pin-list.svg';\nimport './style.scss';\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.Options\n * @property {boolean} [clickEventOnMarker=false] If a `click` event is triggered on the viewer additionally to the `select-marker` event.\n * @property {PSV.plugins.MarkersPlugin.Properties[]} [markers]\n */\n\n/**\n * @typedef {Object} PSV.plugins.MarkersPlugin.SelectMarkerData\n * @summary Data of the `select-marker` event\n * @property {boolean} dblclick - if the selection originated from a double click, the simple click is always fired before the double click\n * @property {boolean} rightclick - if the selection originated from a right click\n */\n\n\n// add markers buttons\nDEFAULTS.navbar.splice(DEFAULTS.navbar.indexOf('caption'), 0, MarkersButton.id, MarkersListButton.id);\nDEFAULTS.lang[MarkersButton.id] = 'Markers';\nDEFAULTS.lang[MarkersListButton.id] = 'Markers list';\nregisterButton(MarkersButton);\nregisterButton(MarkersListButton);\n\n\n/**\n * @summary Displays various markers on the viewer\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport default class MarkersPlugin extends AbstractPlugin {\n\n  static id = 'markers';\n\n  /**\n   * @summary Available events\n   * @enum {string}\n   * @constant\n   */\n  static EVENTS = {\n    GOTO_MARKER_DONE   : 'goto-marker-done',\n    LEAVE_MARKER       : 'leave-marker',\n    OVER_MARKER        : 'over-marker',\n    RENDER_MARKERS_LIST: 'render-markers-list',\n    SELECT_MARKER      : 'select-marker',\n    SELECT_MARKER_LIST : 'select-marker-list',\n    UNSELECT_MARKER    : 'unselect-marker',\n    HIDE_MARKERS       : 'hide-markers',\n    SHOW_MARKERS       : 'show-markers',\n  };\n\n  /**\n   * @summary Namespace for SVG creation\n   * @type {string}\n   * @constant\n   */\n  static SVG_NS = 'http://www.w3.org/2000/svg';\n\n  /**\n   * @summary Property name added to marker elements\n   * @type {string}\n   * @constant\n   */\n  static MARKER_DATA = 'psvMarker';\n\n  /**\n   * @summary Panel identifier for marker content\n   * @type {string}\n   * @constant\n   */\n  static ID_PANEL_MARKER = 'marker';\n\n  /**\n   * @summary Panel identifier for markers list\n   * @type {string}\n   * @constant\n   */\n  static ID_PANEL_MARKERS_LIST = 'markersList';\n\n  /**\n   * @summary Markers list template\n   * @param {PSV.Marker[]} markers\n   * @param {string} title\n   * @param {string} dataKey\n   * @returns {string}\n   */\n  static MARKERS_LIST_TEMPLATE = (markers, title, dataKey) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n  <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n  <ul class=\"psv-panel-menu-list\">\n    ${markers.map(marker => `\n    <li data-${dataKey}=\"${marker.config.id}\" class=\"psv-panel-menu-item\">\n      ${marker.type === 'image' ? `<span class=\"psv-panel-menu-item-icon\" ><img src=\"${marker.config.image}\"/></span>` : ''}\n      <span class=\"psv-panel-menu-item-label\">${marker.getListContent()}</span>\n    </li>\n    `).join('')}\n  </ul>\n</div>\n`;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.MarkersPlugin.Options} [options]\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {HTMLElement}\n     * @readonly\n     */\n    this.container = document.createElement('div');\n    this.container.className = 'psv-markers';\n    this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n    this.psv.container.appendChild(this.container);\n\n    /**\n     * @summary All registered markers\n     * @member {Object<string, PSV.plugins.MarkersPlugin.Marker>}\n     */\n    this.markers = {};\n\n    /**\n     * @type {Object}\n     * @property {boolean} visible - Visibility of the component\n     * @property {PSV.plugins.MarkersPlugin.Marker} currentMarker - Last selected marker\n     * @property {PSV.plugins.MarkersPlugin.Marker} hoveringMarker - Marker under the cursor\n     * @private\n     */\n    this.prop = {\n      visible       : true,\n      currentMarker : null,\n      hoveringMarker: null,\n    };\n\n    /**\n     * @type {PSV.plugins.MarkersPlugin.Options}\n     */\n    this.config = {\n      clickEventOnMarker: false,\n      ...options,\n    };\n\n    /**\n     * @member {SVGElement}\n     * @readonly\n     */\n    this.svgContainer = document.createElementNS(MarkersPlugin.SVG_NS, 'svg');\n    this.svgContainer.setAttribute('class', 'psv-markers-svg-container');\n    this.container.appendChild(this.svgContainer);\n\n    // Markers events via delegation\n    this.container.addEventListener('mouseenter', this, true);\n    this.container.addEventListener('mouseleave', this, true);\n    this.container.addEventListener('mousemove', this, true);\n    this.container.addEventListener('contextmenu', this);\n\n    // Viewer events\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.on(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.on(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    if (options?.markers) {\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\n        this.setMarkers(options.markers);\n      });\n    }\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.clearMarkers(false);\n\n    this.container.removeEventListener('mouseenter', this);\n    this.container.removeEventListener('mouseleave', this);\n    this.container.removeEventListener('mousemove', this);\n    this.container.removeEventListener('contextmenu', this);\n\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.DOUBLE_CLICK, this);\n    this.psv.off(CONSTANTS.EVENTS.RENDER, this);\n    this.psv.off(CONSTANTS.EVENTS.CONFIG_CHANGED, this);\n\n    this.psv.container.removeChild(this.container);\n\n    delete this.svgContainer;\n    delete this.markers;\n    delete this.container;\n    delete this.prop;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      // @formatter:off\n      case 'mouseenter':  this.__onMouseEnter(e);  break;\n      case 'mouseleave':  this.__onMouseLeave(e);  break;\n      case 'mousemove':   this.__onMouseMove(e);   break;\n      case 'contextmenu': this.__onContextMenu(e); break;\n      case CONSTANTS.EVENTS.CLICK:        this.__onClick(e, e.args[0], false); break;\n      case CONSTANTS.EVENTS.DOUBLE_CLICK: this.__onClick(e, e.args[0], true);  break;\n      case CONSTANTS.EVENTS.RENDER:       this.renderMarkers();                        break;\n      case CONSTANTS.EVENTS.CONFIG_CHANGED:\n        this.container.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\n        break;\n      // @formatter:on\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   * @fires PSV.plugins.MarkersPlugin.show-markers\n   */\n  show() {\n    this.prop.visible = true;\n\n    this.renderMarkers();\n\n    /**\n     * @event show-markers\n     * @memberof PSV.plugins.MarkersPlugin\n     * @summary Triggered when the markers are shown\n     */\n    this.trigger(MarkersPlugin.EVENTS.SHOW_MARKERS);\n  }\n\n  /**\n   * @override\n   * @fires PSV.plugins.MarkersPlugin.hide-markers\n   */\n  hide() {\n    this.prop.visible = false;\n\n    this.renderMarkers();\n\n    /**\n     * @event hide-markers\n     * @memberof PSV.plugins.MarkersPlugin\n     * @summary Triggered when the markers are hidden\n     */\n    this.trigger(MarkersPlugin.EVENTS.HIDE_MARKERS);\n  }\n\n  /**\n   * @summary Toggles the visibility of all tooltips\n   */\n  toggleAllTooltips() {\n    this.prop.showAllTooltips = !this.prop.showAllTooltips;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Displays all tooltips\n   */\n  showAllTooltips() {\n    this.prop.showAllTooltips = true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Hides all tooltips\n   */\n  hideAllTooltips() {\n    this.prop.showAllTooltips = false;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Return the total number of markers\n   * @returns {number}\n   */\n  getNbMarkers() {\n    return Object.keys(this.markers).length;\n  }\n\n  /**\n   * @summary Adds a new marker to viewer\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker's id is missing or already exists\n   */\n  addMarker(properties, render = true) {\n    if (this.markers[properties.id]) {\n      throw new PSVError(`marker \"${properties.id}\" already exists`);\n    }\n\n    const marker = new Marker(properties, this.psv);\n\n    if (marker.isNormal()) {\n      this.container.appendChild(marker.$el);\n    }\n    else {\n      this.svgContainer.appendChild(marker.$el);\n    }\n\n    this.markers[marker.id] = marker;\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Returns the internal marker object for a marker id\n   * @param {string} markerId\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @throws {PSV.PSVError} when the marker cannot be found\n   */\n  getMarker(markerId) {\n    const id = typeof markerId === 'object' ? markerId.id : markerId;\n\n    if (!this.markers[id]) {\n      throw new PSVError(`cannot find marker \"${id}\"`);\n    }\n\n    return this.markers[id];\n  }\n\n  /**\n   * @summary Returns the last marker selected by the user\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  getCurrentMarker() {\n    return this.prop.currentMarker;\n  }\n\n  /**\n   * @summary Updates the existing marker with the same id\n   * @description Every property can be changed but you can't change its type (Eg: `image` to `html`).\n   * @param {PSV.plugins.MarkersPlugin.Properties} properties\n   * @param {boolean} [render=true] - renders the marker immediately\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   */\n  updateMarker(properties, render = true) {\n    const marker = this.getMarker(properties.id);\n\n    marker.update(properties);\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n    }\n\n    return marker;\n  }\n\n  /**\n   * @summary Removes a marker from the viewer\n   * @param {string} markerId\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  removeMarker(markerId, render = true) {\n    const marker = this.getMarker(markerId);\n\n    if (marker.isNormal()) {\n      this.container.removeChild(marker.$el);\n    }\n    else {\n      this.svgContainer.removeChild(marker.$el);\n    }\n\n    if (this.prop.hoveringMarker === marker) {\n      this.prop.hoveringMarker = null;\n    }\n\n    if (this.prop.currentMarker === marker) {\n      this.prop.currentMarker = null;\n    }\n\n    marker.hideTooltip();\n\n    marker.destroy();\n    delete this.markers[marker.id];\n\n    if (render) {\n      this.__refreshUi();\n    }\n  }\n\n  /**\n   * @summary Replaces all markers\n   * @param {PSV.plugins.MarkersPlugin.Properties[]} markers\n   * @param {boolean} [render=true] - renders the marker immediately\n   */\n  setMarkers(markers, render = true) {\n    this.clearMarkers(false);\n\n    utils.each(markers, marker => this.addMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n    }\n  }\n\n  /**\n   * @summary Removes all markers\n   * @param {boolean} [render=true] - renders the markers immediately\n   */\n  clearMarkers(render = true) {\n    utils.each(this.markers, marker => this.removeMarker(marker, false));\n\n    if (render) {\n      this.renderMarkers();\n      this.__refreshUi();\n    }\n  }\n\n  /**\n   * @summary Rotate the view to face the marker\n   * @param {string} markerId\n   * @param {string|number} [speed] - rotates smoothy, see {@link PSV.Viewer#animate}\n   * @fires PSV.plugins.MarkersPlugin.goto-marker-done\n   * @return {PSV.Animation}  A promise that will be resolved when the animation finishes\n   */\n  gotoMarker(markerId, speed) {\n    const marker = this.getMarker(markerId);\n\n    return this.psv.animate({\n      ...marker.props.position,\n      speed,\n    })\n      .then(() => {\n        /**\n         * @event goto-marker-done\n         * @memberof PSV.plugins.MarkersPlugin\n         * @summary Triggered when the animation to a marker is done\n         * @param {PSV.plugins.MarkersPlugin.Marker} marker\n         */\n        this.trigger(MarkersPlugin.EVENTS.GOTO_MARKER_DONE, marker);\n      });\n  }\n\n  /**\n   * @summary Hides a marker\n   * @param {string} markerId\n   */\n  hideMarker(markerId) {\n    this.getMarker(markerId).visible = false;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Shows a marker\n   * @param {string} markerId\n   */\n  showMarker(markerId) {\n    this.getMarker(markerId).visible = true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Toggles a marker\n   * @param {string} markerId\n   */\n  toggleMarker(markerId) {\n    this.getMarker(markerId).visible ^= true;\n    this.renderMarkers();\n  }\n\n  /**\n   * @summary Opens the panel with the content of the marker\n   * @param {string} markerId\n   */\n  showMarkerPanel(markerId) {\n    const marker = this.getMarker(markerId);\n\n    if (marker?.config?.content) {\n      this.psv.panel.show({\n        id     : MarkersPlugin.ID_PANEL_MARKER,\n        content: marker.config.content,\n      });\n    }\n    else {\n      this.psv.panel.hide(MarkersPlugin.ID_PANEL_MARKER);\n    }\n  }\n\n  /**\n   * @summary Toggles the visibility of markers list\n   */\n  toggleMarkersList() {\n    if (this.psv.panel.prop.contentId === MarkersPlugin.ID_PANEL_MARKERS_LIST) {\n      this.hideMarkersList();\n    }\n    else {\n      this.showMarkersList();\n    }\n  }\n\n  /**\n   * @summary Opens side panel with list of markers\n   * @fires PSV.plugins.MarkersPlugin.filter:render-markers-list\n   */\n  showMarkersList() {\n    let markers = [];\n    utils.each(this.markers, (marker) => {\n      if (marker.visible && !marker.config.hideList) {\n        markers.push(marker);\n      }\n    });\n\n    /**\n     * @event filter:render-markers-list\n     * @memberof PSV.plugins.MarkersPlugin\n     * @summary Used to alter the list of markers displayed on the side-panel\n     * @param {PSV.plugins.MarkersPlugin.Marker[]} markers\n     * @returns {PSV.plugins.MarkersPlugin.Marker[]}\n     */\n    markers = this.change(MarkersPlugin.EVENTS.RENDER_MARKERS_LIST, markers);\n\n    this.psv.panel.show({\n      id          : MarkersPlugin.ID_PANEL_MARKERS_LIST,\n      content     : MarkersPlugin.MARKERS_LIST_TEMPLATE(\n        markers,\n        this.psv.config.lang.markers,\n        utils.dasherize(MarkersPlugin.MARKER_DATA)\n      ),\n      noMargin    : true,\n      clickHandler: (e) => {\n        const li = e.target ? utils.getClosest(e.target, 'li') : undefined;\n        const markerId = li ? li.dataset[MarkersPlugin.MARKER_DATA] : undefined;\n\n        if (markerId) {\n          const marker = this.getMarker(markerId);\n\n          /**\n           * @event select-marker-list\n           * @memberof PSV.plugins.MarkersPlugin\n           * @summary Triggered when a marker is selected from the side panel\n           * @param {PSV.plugins.MarkersPlugin.Marker} marker\n           */\n          this.trigger(MarkersPlugin.EVENTS.SELECT_MARKER_LIST, marker);\n\n          this.gotoMarker(marker, 1000);\n          this.hideMarkersList();\n        }\n      },\n    });\n  }\n\n  /**\n   * @summary Closes side panel if it contains the list of markers\n   */\n  hideMarkersList() {\n    this.psv.panel.hide(MarkersPlugin.ID_PANEL_MARKERS_LIST);\n  }\n\n  /**\n   * @summary Updates the visibility and the position of all markers\n   */\n  renderMarkers() {\n    utils.each(this.markers, (marker) => {\n      let isVisible = this.prop.visible && marker.visible;\n\n      if (isVisible && marker.isPoly()) {\n        const positions = this.__getPolyPositions(marker);\n        isVisible = positions.length > (marker.isPolygon() ? 2 : 1);\n\n        if (isVisible) {\n          const position = this.__getMarkerPosition(marker);\n          marker.props.position2D = position;\n\n          const points = positions.map(pos => (pos.x - position.x) + ',' + (pos.y - position.y)).join(' ');\n\n          marker.$el.setAttributeNS(null, 'points', points);\n          marker.$el.setAttributeNS(null, 'transform', `translate(${position.x} ${position.y})`);\n        }\n      }\n      else if (isVisible) {\n        if (marker.props.dynamicSize) {\n          this.__updateMarkerSize(marker);\n        }\n\n        const scale = marker.getScale(this.psv.getZoomLevel());\n        const position = this.__getMarkerPosition(marker, scale);\n        isVisible = this.__isMarkerVisible(marker, position);\n\n        if (isVisible) {\n          marker.props.position2D = position;\n\n          if (marker.isSvg()) {\n            let transform = `translate(${position.x}, ${position.y})`;\n            if (scale !== 1) {\n              transform += ` scale(${scale}, ${scale})`;\n            }\n\n            marker.$el.setAttributeNS(null, 'transform', transform);\n          }\n          else {\n            let transform = `translate3D(${position.x}px, ${position.y}px, 0px)`;\n            if (scale !== 1) {\n              transform += ` scale(${scale}, ${scale})`;\n            }\n\n            marker.$el.style.transform = transform;\n          }\n        }\n      }\n\n      marker.props.inViewport = isVisible;\n      utils.toggleClass(marker.$el, 'psv-marker--visible', isVisible);\n\n      if (marker.props.inViewport && (this.prop.showAllTooltips || (marker === this.prop.hoveringMarker && !marker.isPoly()))) {\n        marker.showTooltip();\n      }\n      else if (!marker.props.inViewport || marker !== this.prop.hoveringMarker) {\n        marker.hideTooltip();\n      }\n    });\n  }\n\n  /**\n   * @summary Determines if a point marker is visible<br>\n   * It tests if the point is in the general direction of the camera, then check if it's in the viewport\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {PSV.Point} position\n   * @returns {boolean}\n   * @private\n   */\n  __isMarkerVisible(marker, position) {\n    return marker.props.positions3D[0].dot(this.psv.prop.direction) > 0\n      && position.x + marker.props.width >= 0\n      && position.x - marker.props.width <= this.psv.prop.size.width\n      && position.y + marker.props.height >= 0\n      && position.y - marker.props.height <= this.psv.prop.size.height;\n  }\n\n  /**\n   * @summary Computes the real size of a marker\n   * @description This is done by removing all it's transformations (if any) and making it visible\n   * before querying its bounding rect\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @private\n   */\n  __updateMarkerSize(marker) {\n    utils.addClasses(marker.$el, 'psv-marker--transparent');\n\n    let transform;\n    if (marker.isSvg()) {\n      transform = marker.$el.getAttributeNS(null, 'transform');\n      marker.$el.removeAttributeNS(null, 'transform');\n    }\n    else {\n      transform = marker.$el.style.transform;\n      marker.$el.style.transform = '';\n    }\n\n    const rect = marker.$el.getBoundingClientRect();\n    marker.props.width = rect.width;\n    marker.props.height = rect.height;\n\n    utils.removeClasses(marker.$el, 'psv-marker--transparent');\n\n    if (transform) {\n      if (marker.isSvg()) {\n        marker.$el.setAttributeNS(null, 'transform', transform);\n      }\n      else {\n        marker.$el.style.transform = transform;\n      }\n    }\n\n    // the size is no longer dynamic once known\n    marker.props.dynamicSize = false;\n  }\n\n  /**\n   * @summary Computes viewer coordinates of a marker\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @param {number} [scale=1]\n   * @returns {PSV.Point}\n   * @private\n   */\n  __getMarkerPosition(marker, scale = 1) {\n    if (marker.isPoly()) {\n      return this.psv.dataHelper.vector3ToViewerCoords(this.psv.dataHelper.sphericalCoordsToVector3(marker.props.position));\n    }\n    else {\n      const position = this.psv.dataHelper.vector3ToViewerCoords(marker.props.positions3D[0]);\n\n      position.x -= marker.props.width * marker.props.anchor.x * scale;\n      position.y -= marker.props.height * marker.props.anchor.y * scale;\n\n      return position;\n    }\n  }\n\n  /**\n   * @summary Computes viewer coordinates of each point of a polygon/polyline<br>\n   * It handles points behind the camera by creating intermediary points suitable for the projector\n   * @param {PSV.plugins.MarkersPlugin.Marker} marker\n   * @returns {PSV.Point[]}\n   * @private\n   */\n  __getPolyPositions(marker) {\n    const nbVectors = marker.props.positions3D.length;\n\n    // compute if each vector is visible\n    const positions3D = marker.props.positions3D.map((vector) => {\n      return {\n        vector : vector,\n        visible: vector.dot(this.psv.prop.direction) > 0,\n      };\n    });\n\n    // get pairs of visible/invisible vectors for each invisible vector connected to a visible vector\n    const toBeComputed = [];\n    positions3D.forEach((pos, i) => {\n      if (!pos.visible) {\n        const neighbours = [\n          i === 0 ? positions3D[nbVectors - 1] : positions3D[i - 1],\n          i === nbVectors - 1 ? positions3D[0] : positions3D[i + 1],\n        ];\n\n        neighbours.forEach((neighbour) => {\n          if (neighbour.visible) {\n            toBeComputed.push({\n              visible  : neighbour,\n              invisible: pos,\n              index    : i,\n            });\n          }\n        });\n      }\n    });\n\n    // compute intermediary vector for each pair (the loop is reversed for splice to insert at the right place)\n    toBeComputed.reverse().forEach((pair) => {\n      positions3D.splice(pair.index, 0, {\n        vector : this.__getPolyIntermediaryPoint(pair.visible.vector, pair.invisible.vector),\n        visible: true,\n      });\n    });\n\n    // translate vectors to screen pos\n    return positions3D\n      .filter(pos => pos.visible)\n      .map(pos => this.psv.dataHelper.vector3ToViewerCoords(pos.vector));\n  }\n\n  /**\n   * Given one point in the same direction of the camera and one point behind the camera,\n   * computes an intermediary point on the great circle delimiting the half sphere visible by the camera.\n   * The point is shifted by .01 rad because the projector cannot handle points exactly on this circle.\n   * TODO : does not work with fisheye view (must not use the great circle)\n   * {@link http://math.stackexchange.com/a/1730410/327208}\n   * @param P1 {external:THREE.Vector3}\n   * @param P2 {external:THREE.Vector3}\n   * @returns {external:THREE.Vector3}\n   * @private\n   */\n  __getPolyIntermediaryPoint(P1, P2) {\n    const C = this.psv.prop.direction.clone().normalize();\n    const N = new THREE.Vector3().crossVectors(P1, P2).normalize();\n    const V = new THREE.Vector3().crossVectors(N, P1).normalize();\n    const X = P1.clone().multiplyScalar(-C.dot(V));\n    const Y = V.clone().multiplyScalar(C.dot(P1));\n    const H = new THREE.Vector3().addVectors(X, Y).normalize();\n    const a = new THREE.Vector3().crossVectors(H, C);\n    return H.applyAxisAngle(a, 0.01).multiplyScalar(CONSTANTS.SPHERE_RADIUS);\n  }\n\n  /**\n   * @summary Returns the marker associated to an event target\n   * @param {EventTarget} target\n   * @param {boolean} [closest=false]\n   * @returns {PSV.plugins.MarkersPlugin.Marker}\n   * @private\n   */\n  __getTargetMarker(target, closest = false) {\n    const target2 = closest ? utils.getClosest(target, '.psv-marker') : target;\n    return target2 ? target2[MarkersPlugin.MARKER_DATA] : undefined;\n  }\n\n  /**\n   * @summary Checks if an event target is in the tooltip\n   * @param {EventTarget} target\n   * @param {PSV.components.Tooltip} tooltip\n   * @returns {boolean}\n   * @private\n   */\n  __targetOnTooltip(target, tooltip) {\n    return target && tooltip ? utils.hasParent(target, tooltip.container) : false;\n  }\n\n  /**\n   * @summary Handles mouse enter events, show the tooltip for non polygon markers\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseEnter(e) {\n    const marker = this.__getTargetMarker(e.target);\n\n    if (marker && !marker.isPoly()) {\n      this.prop.hoveringMarker = marker;\n\n      /**\n       * @event over-marker\n       * @memberof PSV.plugins.MarkersPlugin\n       * @summary Triggered when the user puts the cursor hover a marker\n       * @param {PSV.plugins.MarkersPlugin.Marker} marker\n       */\n      this.trigger(MarkersPlugin.EVENTS.OVER_MARKER, marker);\n\n      if (!this.prop.showAllTooltips) {\n        marker.showTooltip(e);\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse leave events, hide the tooltip\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @private\n   */\n  __onMouseLeave(e) {\n    const marker = this.__getTargetMarker(e.target);\n\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    if (marker && !(marker.isPoly() && this.__targetOnTooltip(e.relatedTarget, marker.tooltip))) {\n      /**\n       * @event leave-marker\n       * @memberof PSV.plugins.MarkersPlugin\n       * @summary Triggered when the user puts the cursor away from a marker\n       * @param {PSV.plugins.MarkersPlugin.Marker} marker\n       */\n      this.trigger(MarkersPlugin.EVENTS.LEAVE_MARKER, marker);\n\n      this.prop.hoveringMarker = null;\n\n      if (!this.prop.showAllTooltips) {\n        marker.hideTooltip();\n      }\n    }\n  }\n\n  /**\n   * @summary Handles mouse move events, refreshUi the tooltip for polygon markers\n   * @param {MouseEvent} e\n   * @fires PSV.plugins.MarkersPlugin.leave-marker\n   * @fires PSV.plugins.MarkersPlugin.over-marker\n   * @private\n   */\n  __onMouseMove(e) {\n    let marker;\n    const targetMarker = this.__getTargetMarker(e.target);\n\n    if (targetMarker?.isPoly()) {\n      marker = targetMarker;\n    }\n    // do not hide if we enter the tooltip itself while hovering a polygon\n    else if (this.prop.hoveringMarker && this.__targetOnTooltip(e.target, this.prop.hoveringMarker.tooltip)) {\n      marker = this.prop.hoveringMarker;\n    }\n\n    if (marker) {\n      if (!this.prop.hoveringMarker) {\n        this.trigger(MarkersPlugin.EVENTS.OVER_MARKER, marker);\n\n        this.prop.hoveringMarker = marker;\n      }\n\n      if (!this.prop.showAllTooltips) {\n        marker.showTooltip(e);\n      }\n    }\n    else if (this.prop.hoveringMarker?.isPoly()) {\n      this.trigger(MarkersPlugin.EVENTS.LEAVE_MARKER, this.prop.hoveringMarker);\n\n      if (!this.prop.showAllTooltips) {\n        this.prop.hoveringMarker.hideTooltip();\n      }\n\n      this.prop.hoveringMarker = null;\n    }\n  }\n\n  /**\n   * @summary Handles context menu events\n   * @param {MouseWheelEvent} evt\n   * @private\n   */\n  __onContextMenu(evt) {\n    if (!utils.getClosest(evt.target, '.psv-marker')) {\n      return true;\n    }\n\n    evt.preventDefault();\n    return false;\n  }\n\n  /**\n   * @summary Handles mouse click events, select the marker and open the panel if necessary\n   * @param {Event} e\n   * @param {Object} data\n   * @param {boolean} dblclick\n   * @fires PSV.plugins.MarkersPlugin.select-marker\n   * @fires PSV.plugins.MarkersPlugin.unselect-marker\n   * @private\n   */\n  __onClick(e, data, dblclick) {\n    const marker = this.__getTargetMarker(data.target, true);\n\n    if (marker) {\n      this.prop.currentMarker = marker;\n\n      /**\n       * @event select-marker\n       * @memberof PSV.plugins.MarkersPlugin\n       * @summary Triggered when the user clicks on a marker. The marker can be retrieved from outside the event handler\n       * with {@link PSV.plugins.MarkersPlugin.getCurrentMarker}\n       * @param {PSV.plugins.MarkersPlugin.Marker} marker\n       * @param {PSV.plugins.MarkersPlugin.SelectMarkerData} data\n       */\n      this.trigger(MarkersPlugin.EVENTS.SELECT_MARKER, marker, {\n        dblclick  : dblclick,\n        rightclick: data.rightclick,\n      });\n\n      if (this.config.clickEventOnMarker) {\n        // add the marker to event data\n        data.marker = marker;\n      }\n      else {\n        e.stopPropagation();\n      }\n\n      // the marker could have been deleted in an event handler\n      if (this.markers[marker.id]) {\n        this.showMarkerPanel(marker.id);\n      }\n    }\n    else if (this.prop.currentMarker) {\n      /**\n       * @event unselect-marker\n       * @memberof PSV.plugins.MarkersPlugin\n       * @summary Triggered when a marker was selected and the user clicks elsewhere\n       * @param {PSV.plugins.MarkersPlugin.Marker} marker\n       */\n      this.trigger(MarkersPlugin.EVENTS.UNSELECT_MARKER, this.prop.currentMarker);\n\n      this.psv.panel.hide(MarkersPlugin.ID_PANEL_MARKER);\n\n      this.prop.currentMarker = null;\n    }\n  }\n\n  /**\n   * @summary Updates the visiblity of the panel and the buttons\n   * @private\n   */\n  __refreshUi() {\n    const nbMarkers = Object.values(this.markers).filter(m => !m.config.hideList).length;\n    const markersButton = this.psv.navbar.getButton(MarkersButton.id, false);\n    const markersListButton = this.psv.navbar.getButton(MarkersListButton.id, false);\n\n    if (nbMarkers === 0) {\n      markersButton?.hide();\n      markersListButton?.hide();\n\n      if (this.psv.panel.isVisible(MarkersPlugin.ID_PANEL_MARKERS_LIST)) {\n        this.psv.panel.hide();\n      }\n      else if (this.psv.panel.isVisible(MarkersPlugin.ID_PANEL_MARKER)) {\n        this.psv.panel.hide();\n      }\n    }\n    else {\n      markersButton?.show();\n      markersListButton?.show();\n\n      if (this.psv.panel.isVisible(MarkersPlugin.ID_PANEL_MARKERS_LIST)) {\n        this.showMarkersList();\n      }\n      else if (this.psv.panel.isVisible(MarkersPlugin.ID_PANEL_MARKER)) {\n        this.prop.currentMarker ? this.showMarkerPanel(this.prop.currentMarker) : this.psv.panel.hide();\n      }\n    }\n  }\n\n}\n"],"names":["greatArcIntermediaryPoint","p1","p2","f","λ1","φ1","λ2","φ2","r","utils","greatArcDistance","a","Math","sin","b","x","cos","y","z","atan2","sqrt","getPolygonCenter","polygon","workPoints","k","i","length","d","PI","push","sum","reduce","intermediary","point","parseAngle","getPolylineCenter","polyline","lengths","l","CONSTANTS","SPHERE_RADIUS","consumed","j","round","MARKER_TYPES","image","html","polygonPx","polygonRad","polylinePx","polylineRad","square","rect","circle","ellipse","path","Marker","properties","psv","id","PSVError","type","getType","visible","$el","config","data","undefined","tooltip","props","inViewport","dynamicSize","anchor","position","position2D","positions3D","width","height","def","isNormal","document","createElement","isPolygon","createElementNS","MarkersPlugin","SVG_NS","isPolyline","MARKER_DATA","update","destroy","isPoly","isPolyPx","isPolyRad","isSvg","getScale","zoomLevel","Array","isArray","scale","EASINGS","inQuad","getListContent","listContent","content","showTooltip","mousePosition","boundingRect","container","getBoundingClientRect","box","size","arrow","top","clientY","left","clientX","move","create","hideTooltip","hide","newType","deepmerge","setAttribute","className","addClasses","style","parsePosition","__updateNormal","__updatePoly","__updateSvg","isExtendedPosition","backgroundImage","innerHTML","transformOrigin","dataHelper","cleanPosition","sphericalCoordsToVector3","cx","cy","rx","ry","each","value","prop","setAttributeNS","svgStyle","dasherize","fill","actualPoly","splice","map","coord","sphericalCoords","textureCoordsToSphericalCoords","longitude","latitude","centroid","allowNone","found","Object","keys","join","MarkersButton","navbar","plugin","getPlugin","on","EVENTS","SHOW_MARKERS","HIDE_MARKERS","toggleActive","off","isSupported","handleEvent","e","onClick","show","AbstractButton","icon","pin","MarkersListButton","OPEN_PANEL","CLOSE_PANEL","args","ID_PANEL_MARKERS_LIST","toggleMarkersList","pinList","DEFAULTS","indexOf","lang","registerButton","options","cursor","mousemove","appendChild","markers","currentMarker","hoveringMarker","clickEventOnMarker","svgContainer","addEventListener","CLICK","DOUBLE_CLICK","RENDER","CONFIG_CHANGED","once","READY","setMarkers","clearMarkers","removeEventListener","removeChild","__onMouseEnter","__onMouseLeave","__onMouseMove","__onContextMenu","__onClick","renderMarkers","trigger","toggleAllTooltips","showAllTooltips","hideAllTooltips","getNbMarkers","addMarker","render","marker","__refreshUi","getMarker","markerId","getCurrentMarker","updateMarker","removeMarker","gotoMarker","speed","animate","then","GOTO_MARKER_DONE","hideMarker","showMarker","toggleMarker","showMarkerPanel","panel","ID_PANEL_MARKER","contentId","hideMarkersList","showMarkersList","hideList","change","RENDER_MARKERS_LIST","MARKERS_LIST_TEMPLATE","noMargin","clickHandler","li","target","getClosest","dataset","SELECT_MARKER_LIST","isVisible","positions","__getPolyPositions","__getMarkerPosition","points","pos","__updateMarkerSize","getZoomLevel","__isMarkerVisible","transform","toggleClass","dot","direction","getAttributeNS","removeAttributeNS","removeClasses","vector3ToViewerCoords","nbVectors","vector","toBeComputed","forEach","neighbours","neighbour","invisible","index","reverse","pair","__getPolyIntermediaryPoint","filter","P1","P2","C","clone","normalize","N","THREE","crossVectors","V","X","multiplyScalar","Y","H","addVectors","applyAxisAngle","__getTargetMarker","closest","target2","__targetOnTooltip","hasParent","OVER_MARKER","relatedTarget","LEAVE_MARKER","targetMarker","evt","preventDefault","dblclick","SELECT_MARKER","rightclick","stopPropagation","UNSELECT_MARKER","nbMarkers","values","m","markersButton","getButton","markersListButton","AbstractPlugin","title","dataKey"],"mappings":"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"}